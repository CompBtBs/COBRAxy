<tool id="importMetabolicModel" name="Import Metabolic Model" version="2.0.0">
    <description>Import a tabular model from file format (SBML, JSON, MAT or YAML)</description>

	<requirements>
        <requirement type="package" version="1.24.4">numpy</requirement>
        <requirement type="package" version="2.0.3">pandas</requirement>
		<requirement type="package" version="0.29.0">cobra</requirement>
        <requirement type="package" version="5.2.2">lxml</requirement>
	</requirements>

    <macros>
        <import>marea_macros.xml</import>
    </macros>

    <command detect_errors="exit_code">
        <![CDATA[
      	python $__tool_directory__/importMetabolicModel.py
        --tool_dir $__tool_directory__
        --medium_selector $cond_model.cond_medium.medium_selector
        #if $cond_model.model_selector == 'Custom_model'
            --input $cond_model.input
            --name $cond_model.input.element_identifier
            --out_tabular $out_tabular_custom
        #elif $cond_model.model_selector == 'ENGRO2'
            --model $cond_model.model_selector
            --name $cond_model.model_selector
            --out_tabular $out_tabular_engro2
        #else
            --model $cond_model.model_selector
            --name $cond_model.model_selector
            --out_tabular $out_tabular_recon
        #end if
        --gene_format $cond_model.gene_format
        --out_log $log
        ]]>
    </command>
    <inputs>
        <conditional name="cond_model">
            <expand macro="options_model"/>
            
            <!-- ENGRO2 -->
            <when value="ENGRO2">
            
                <conditional name="cond_medium">
                    <expand macro="options_ras_to_bounds_medium"/>
                </conditional>

                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature (HGNC Symbol)</option>
                    <option value="ENSG">ENSG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>

            <!-- Recon -->
            <when value="Recon">
            
                <conditional name="cond_medium">
                    <param name="medium_selector" argument="--medium_selector" type="select" label="Medium">
                        <option value="Default" selected="true">Default (Recon built-in medium)</option>
                    </param>
                    <when value="Default">
                        <!-- Nessun parametro aggiuntivo necessario -->
                    </when>
                </conditional>
                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature (HGNC Symbol)</option>
                    <option value="ENSG">ENSG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>

            <!-- Custom model -->
            <when value="Custom_model">
                <param name="input" argument="--input" type="data" format="sbml,json,mat,yaml" label="Custom model file:" />
                <conditional name="cond_medium">
                    <param name="medium_selector" argument="--medium_selector" type="select" label="Medium">
                        <option value="Default" selected="true">Default (custom model medium)</option>
                    </param>
                    <when value="Default">
                        <!-- Nessun parametro aggiuntivo necessario -->
                    </when>
                </conditional>
                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature</option>
                    <option value="HGNC_symbol">HGNC Symbol</option>
                    <option value="ENSG">ENSG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>
        </conditional>

    </inputs>

    <outputs>
        <data name="log" format="txt" label="MetabolicModelSetting - Log" />
        
        <data name="out_tabular_engro2" format="tabular" label="ENGRO2_model_tabular">
            <filter>cond_model['model_selector'] == 'ENGRO2'</filter>
        </data>
        
        <data name="out_tabular_recon" format="tabular" label="Recon_model_tabular">
            <filter>cond_model['model_selector'] == 'Recon'</filter>
        </data>

        <data name="out_tabular_custom" format="tabular" label="${cond_model.input.element_identifier}_model_tabular">
            <filter>cond_model['model_selector'] == 'Custom_model'</filter>
        </data>
    </outputs>

    <help>
    <![CDATA[
Overview
-------------
This tool generates a tabular file (.tabular) containing the main information of the metabolic model, starting either from a built-in model or a user-provided model file. 

For built-in models, users can select among different nutrient-informed variants (i.e., different media composition) and gene nomenclature formats.

The generated tabular file can be used as input for tools Expression2RAS, Expression2RPS, RAS2Bounds, Flux Simulation and Export Metabolic Model - within the COBRAxy suite.

Input parameters:
-------------

The tool has three input parameters:
    - Model: a file containing metabolic information (reactions, metabolites, genes). Ready-to-use models are ENGRO2 and Recon3D. The user can also upload a custom model (see TIP 1).
    - Medium: choose a growth medium typically used for cell culture (see TIP 2 & 3). 
    - Gene nomenclature format: use the original GPR gene names or translate them into another nomenclature.

Output files:
-------------

The tool generates:
	- one tabular file (.tabular) containing reaction IDs, reaction formula, GPR rules, reaction bounds, objective function coefficients, pathways in which the reaction is involved and a flag indicating whether the reaction is an exchange reaction (i.e., related to the growth medium).
    - a log file (.txt).

**TIP 1**: Different input files can be used as the input model. The possible formats are SBML, JSON, MAT or YAML (.yml). 
    Supported compressed formats: .zip, .gz and .bz2. Filename must follow the pattern: {model_name}.{extension}.[zip|gz|bz2]
    More detail can be found at https://cobrapy.readthedocs.io/en/latest/io.html

**TIP 2**:  for pre-existing models ENGRO2 and RECON3D, the user can select the default built-in medium or one of the possible growth medium typically used for cell line cultures.
In case no specific information is available, it is possible to set an "OPEN" medium in which all the nutrients are available in unlimited quantity.

**TIP 3:** Medium composition can be derived from the tabular file. Exchange reactions with `InMedium = TRUE` are included. Nutrient values correspond to the lower bound (e.g., EX_Glc_D_e lower bound -10 â†’ nutrient value 10).  
More info: [COBRApy Media](https://cobrapy-cdiener.readthedocs.io/en/latest/media.html)

    ]]>
    </help>
    <expand macro="citations" />

</tool>




