<tool id="metabolicModel2Tabular" name="metabolicModel2Tabular" version="2.0.0">

	<requirements>
        <requirement type="package" version="1.24.4">numpy</requirement>
        <requirement type="package" version="2.0.3">pandas</requirement>
		<requirement type="package" version="0.29.0">cobra</requirement>
        <requirement type="package" version="5.2.2">lxml</requirement>
	</requirements>

    <macros>
        <import>marea_macros.xml</import>
    </macros>

    <command detect_errors="exit_code">
        <![CDATA[
      	python $__tool_directory__/metabolicModel2Tabular.py
        --tool_dir $__tool_directory__
        --medium_selector $cond_model.cond_medium.medium_selector
        #if $cond_model.model_selector == 'Custom_model'
            --input $cond_model.input
            --name $cond_model.input.element_identifier
        #else
            --model $cond_model.model_selector
            --name $cond_model.model_selector
        #end if

        --gene_format $cond_model.gene_format
        
        --out_log $log
        --out_tabular $out_tabular
        ]]>
    </command>
    <inputs>
        <conditional name="cond_model">
            <expand macro="options_model"/>
            
            <!-- ENGRO2 -->
            <when value="ENGRO2">
                <param name="name" argument="--name" type="text" value="ENGRO2" hidden="true" />
                <conditional name="cond_medium">
                    <expand macro="options_ras_to_bounds_medium"/>
                </conditional>

                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature (HGNC Symbol)</option>
                    <option value="ENSG">ENSNG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>

            <!-- Recon -->
            <when value="Recon">
                <param name="name" argument="--name" type="text" value="Recon" hidden="true" />
                <conditional name="cond_medium">
                    <param name="medium_selector" argument="--medium_selector" type="select" label="Medium">
                        <option value="Default" selected="true">Default (Recon built-in medium)</option>
                    </param>
                    <when value="Default">
                        <!-- Nessun parametro aggiuntivo necessario -->
                    </when>
                </conditional>
                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature (HGNC Symbol)</option>
                    <option value="ENSG">ENSNG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>

            <!-- Custom model -->
            <when value="Custom_model">
                <param name="input" argument="--input" type="data" format="json,xml,sbml" label="Custom model file:" />
                <conditional name="cond_medium">
                    <param name="medium_selector" argument="--medium_selector" type="select" label="Medium">
                        <option value="Default" selected="true">Don't use a separate medium file (use model defaults)</option>
                    </param>
                    <when value="Default">
                        <!-- Nessun parametro aggiuntivo necessario -->
                    </when>
                </conditional>
                <param name="gene_format" argument="--gene_format" type="select" label="Gene nomenclature format:">
                    <option value="Default" selected="true">Keep original gene nomenclature</option>
                    <option value="HGNC_symbol">HGNC Symbol</option>
                    <option value="ENSG">ENSNG (Ensembl Gene ID)</option>
                    <option value="HGNC_ID">HGNC ID</option>
                    <option value="entrez_id">Entrez Gene ID</option>
                </param>
            </when>
        </conditional>

    </inputs>

    <outputs>
        <data name="log" format="txt" label="MetabolicModelSetting - Log" />
        <data name="out_tabular" format="tabular" label="${cond_model.model_selector}_model_tabular" optional="true"/>
    </outputs>

    <help>
    <![CDATA[
What it does
-------------
This tool generates one file containing the main information of the metabolic model, starting from a custom model. 
This file can be used as input for the RAS  generator tool, RPS generator tools, and flux simulator tool.

Accepted files:
    - A model: JSON, XML, MAT or YAML (.yml) file reporting reactions and rules contained in the model. Supported compressed formats: .zip, .gz and .bz2. Filename must follow the pattern: {model_name}.{extension}.[zip|gz|bz2]

Output:
-------------

The tool generates a tabular file containing:
	- a tabular file (.tabular) containing reaction IDs, reaction formula, GPR rules, reaction bounds, the objective function coefficients, the pathways in which the reaction is involved and which reactions are part of the medium.
    - a log file (.txt).
    ]]>
    </help>
    <expand macro="citations" />

</tool>


